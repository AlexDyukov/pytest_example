version: '2.3'
services:
        tests:
                build: .
                depends_on:
                        - postgres
                        - rabbitmq
                volumes:
                        - ./:/tests
                working_dir: /tests
                command: pytest mytest1 --cache-clear --html=report.html
        postgres:       
                image: postgres
                environment:
                        POSTGRES_PASSWORD: postgres
                ports:
                        - '5432:5432'
                healthcheck:
                        test: ["CMD-SHELL", "pg_isready -U postgres"]
                        interval: 10s
                        timeout: 5s
                        retries: 5
        rabbitmq:
                image: rabbitmq:management
                ports:
                        - '5672:5672'
                        - '15672:15672'
                healthcheck:
                        test: rabbitmq-diagnostics -q ping
                        interval: 10s
                        timeout: 5s
                        retries: 5
